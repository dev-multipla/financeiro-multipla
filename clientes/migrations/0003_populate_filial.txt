from django.db import migrations

def set_default_filial(apps, schema_editor):
    Filial = apps.get_model('empresas', 'Filial')
    Cliente = apps.get_model('clientes', 'Cliente')

    # Escolha uma filial “padrão” para preencher.
    # Normalmente a matriz ou a primeira filial cadastrada:
    default_filial = Filial.objects.first()
    if not default_filial:
        return

    # Atualiza todos os clientes sem filial
    Cliente.objects.filter(filial__isnull=True).update(filial=default_filial)

class Migration(migrations.Migration):

    dependencies = [
        ('clientes', '0001_initial'),
        ('clientes', '0002_cliente_filial'),  # a migração que adicionou o campo
        ('empresas', '0001_initial'),
    ]

    operations = [
        migrations.RunPython(set_default_filial, migrations.RunPython.noop),
    ]
